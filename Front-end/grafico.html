<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Monitore sua saúde diária com gráficos e dicas para melhorar o seu desempenho!">
    <title>MeuRitmo</title>
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="style/grafico.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Inicio do header -->
    <header id="header">
        <!-- Menu -->
        <nav id="navbar">
            <!-- Logotipo -->
            <a href="index.html"><img class="logo" src="img/MeuRitmo-logo-Photoroom.png" alt=""></a>

            <ul class="nav-list">
                <li class="nav-item"><a href="index.html">Inicio</a></li>
                <li class="nav-item active"><a href="grafico.html">meu gráfico</a></li>
                <li class="nav-item"><a href="sobre.html">sobre</a></li>
            </ul>

            <div id="menu-icon">
                <img src="img/burger-bar.png" alt="">
            </div>
        </nav>
    </header>
    <!-- Fim do header -->

    <!--Inicio do main-->
    <main>
        <div id="div-grafico">
            <canvas id="grafico"></canvas>
        </div>

        <div id="dados-usuario"></div>

        <div id="dicas"></div>

        <div id="receitas"></div>
    </main>
    <!--Fim do main-->

    <script>
        //Gráfico
        const ctx = document.getElementById('grafico');

        let labelsX = ["Água", "Tempo de treino", "Exercício semanal", "Horas de sono"]
        let valores = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]

        let grafico = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labelsX,
                datasets: [{
                    label: '# of Votes',
                    data: valores,
                    borderWidth: 1,
                    backgroundColor: [
                        '#3e2b8b'
                    ]
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        const id_usuario = parseInt(localStorage.getItem("id_usuario"));
        const sexo = localStorage.getItem("sexo");
        const peso = parseFloat(localStorage.getItem("peso"));
        const objetivo = localStorage.getItem("objetivo");
        const nome = localStorage.getItem("nome");
        const idade = localStorage.getItem("idade");

        console.log(nome)
        console.log(idade)
        console.log(objetivo)
        console.log(id_usuario)
        console.log(sexo)
        console.log(peso)

        const dadosEl = document.getElementById("dados-usuario");

        dadosEl.innerHTML = `
    <div style="margin: 20px 0; font-size: 18px;">
        <strong>Nome:</strong> ${nome} <br>
        <strong>Idade:</strong> ${idade} anos <br>
        <strong>Sexo:</strong> ${sexo} <br>
        <strong>Peso:</strong> ${peso} kg <br>
        <strong>Objetivo:</strong> ${objetivo}
    </div>
`;

        fetch(`http://10.26.45.42:5000/api/v1/resposta/preferencias`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                sexo: sexo,
                objetivo: objetivo,
                peso: peso,
                usuario: id_usuario
            })
        })
            .then(res => res.json())
            .then(res => {
                console.log("Resposta recebida:", res);

                if (Array.isArray(res) && res.length >= 4) {
                    valores[0] = res[0]; // Água
                    valores[1] = res[1]; // Tempo de treino
                    valores[2] = res[3]; // Exercício semanal
                    valores[3] = res[2]; // Sono

                    grafico.update();

                    const dicasEl = document.getElementById("dicas");

                    function gerarDica(titulo, valor, idealMin, idealMax, dicaBoa, dicaRuim) {
                        if (valor >= idealMin && valor <= idealMax) {
                            return `<p style="color: green; margin-top: 20px;"><strong>${titulo}:</strong> ${dicaBoa}</p>`;
                        } else {
                            return `<p style="color: red;  margin-top: 20px;"><strong>${titulo}:</strong> ${dicaRuim}</p>`;
                        }
                    }

                    let dicasHTML = "";
                    dicasHTML += gerarDica("Consumo de água", res[0], 60, 100, "Você está se hidratando bem!", "Tente beber mais água durante o dia.");
                    dicasHTML += gerarDica("Tempo de treino diário", res[1], 50, 100, "Ótimo tempo de treino diário!", "Considere aumentar o tempo dos treinos.");
                    dicasHTML += gerarDica("Exercícios por semana", res[3], 60, 100, "Sua frequência de exercícios está excelente!", "Tente se exercitar mais vezes por semana.");
                    dicasHTML += gerarDica("Horas de sono", res[2], 70, 100, "Você está dormindo bem!", "Tente melhorar sua rotina de sono.");

                    dicasEl.innerHTML = dicasHTML;

                    const obj = localStorage.getItem(objetivo)

                    // Dicas de receitas por objetivo
                    const receitasPorObjetivo = {
                        "perder": [
                            {
                                refeicao: "Café da manhã", dica: "Frutas: 1 fatia de mamão </br> Cereais: 2 colheres de sopa de aveia </br> Pão: 1 fatia de pão integral </br> Ovos: 1 ovo cozido ou mexido sem óleo </br> Beber:1 xícara de café sem açúcar pode adoçar com canela ou adoçante." },
                            { refeicao: "Almoço", dica: "Salada: alface, tomate e cenoura ralada </br> Vegetais: abobrinha e chuchu cozidos </br> Verduras: espinafre refogado </br> Arroz integral: Possui teor de fibras e nutrientes essenciais </br> Fonte de proteína: 1 filé grelhado de frango" },
                            { refeicao: "Lanche", dica: "1 pote de iogurte natural + 1 colher de sopa de aveia." },
                            { refeicao: "Jantar", dica: "Fonte de proteína: omelete de 2 ovos com frango desfiado </br> Vegetais: legumes refogados </br> Arroz integral: O mais recomendado para o emagrecimento" }
                        ],
                        "manter peso": [
                            { refeicao: "Café da manhã", dica: "Iogurte natural com frutas e granola sem açúcar." },
                            { refeicao: "Almoço", dica: "Peixe assado com batata doce e salada colorida." },
                            { refeicao: "Lanche", dica: "Omelete com espinafre e tomate + chá verde." },
                            { refeicao: "Lanche", dica: "Pão integral com pasta de atum." }
                        ],
                        "ganhar": [
                            { refeicao: "Café da manhã", dica: "Vitamina de banana com aveia, leite e pasta de amendoim." },
                            { refeicao: "Almoço", dica: "Arroz, feijão, carne vermelha magra, ovos cozidos e salada." },
                            { refeicao: "Lanche", dica: "Omelete com espinafre e tomate + chá verde." },
                            { refeicao: "Jantar", dica: "Macarrão integral com frango desfiado e molho de tomate caseiro." }
                        ]
                    };

                    const receitas = receitasPorObjetivo[objetivo.toLowerCase()];
                    const receitasEl = document.getElementById("receitas");

                    let receitasHTML = "<h3 style='margin: 20px 0px 0px 5px;'> Sugestões de receitas:</h3>";

                    if (receitas) {
                        receitas.forEach(r => {
                            receitasHTML += `<p style='margin: 20px 0px;'><strong>${r.refeicao}:</strong> </br> ${r.dica}</p>`;
                        });
                    } else {
                        receitasHTML += "<p>Objetivo não reconhecido para sugestões de receita.</p>";
                    }

                    receitasEl.innerHTML = receitasHTML;

                } else {
                    console.warn("Resposta não é um array esperado ou está incompleta:", res);
                }
            })
            .catch(erro => {
                console.log("ERRO: " + erro);


            });
    </script>


    <!-- Inicio do footer -->
    <footer>
        <img src="/Front-end/img/wave.svg" alt="imagem do footer">

        <div id="footer-itens">

            <span id="copyright">
                &copy 2025 Meu Ritmo
            </span>

            <div class="redes-sociais">
                <a href="">
                    <i class="fa-brands fa-whatsapp"></i>
                </a>

                <a href="">
                    <i class="fa-brands fa-github"></i>
                </a>

                <a href="">
                    <i class="fa-brands fa-linkedin"></i>
                </a>
            </div>

            <div class="seta-inicio">
                <a href="#header"><i class="fa-solid fa-arrow-up"></i></a>
            </div>
        </div>
    </footer>
    <!-- Fim do footer -->

    <script src="js/script.js"></script>
</body>

</html>